<%- include('../partials/header') %>
<div class="page-shell">
<section class="shop-hero rounded-4 p-4 p-md-5 mb-4">
  <div class="shop-hero-grid">
    <div>
      <p class="eyebrow text-uppercase">Traceable beans, human roasting</p>
      <h1 class="display-5 fw-semibold text-dark mb-3">
        Rooted in craft. Roasted for clarity.
      </h1>
      <p class="text-muted mb-4">
        Search coffees by flavor, process, or terroir and build a cart that
        matches your ritual.
      </p>
      <div class="d-flex flex-wrap gap-3">
        <a class="btn btn-primary px-4" href="#coffee">Explore beans</a>
        <a class="btn btn-outline-secondary px-4" href="/about"
          >Behind the roast</a
        >
      </div>
    </div>
    <div class="shop-hero-panel">
      <div class="badge bg-white text-dark px-3 py-2 mb-3">
        Fresh · Transparent · Human
      </div>
      <ul class="list-unstyled mb-4">
        <li class="shop-hero-note">Roasted in small batches every morning.</li>
        <li class="shop-hero-note">Flavor tags listed on every card.</li>
        <li class="shop-hero-note">Wishlist any coffee for later.</li>
      </ul>
      <div class="d-flex gap-2 flex-wrap">
        <a class="btn btn-primary flex-grow-1" href="/cart"
          >Cart (<%= cartCount %>)</a
        >
        <a class="btn btn-light flex-grow-1" href="/wishlist">Wishlist</a>
      </div>
    </div>
  </div>
</section>

<section class="shop-search rounded-4 p-4 mb-4">
  <form class="shop-search-form" method="GET" action="/shop">
    <div class="row g-2 align-items-center">
      <div class="col-md-8">
        <label class="form-label text-muted">Search by flavor tags</label>
        <input
          class="form-control form-control-lg"
          type="text"
          name="q"
          value="<%= activeQuery || '' %>"
          placeholder="caramel, floral, bergamot..."
        />
      </div>
      <div class="col-md-4 d-flex gap-2">
        <button class="btn btn-primary flex-grow-1" type="submit">
          Search
        </button>
        <% if (searchApplied) { %>
        <a class="btn btn-outline-secondary" href="/shop">Clear</a>
        <% } %>
      </div>
    </div>
    <% if (searchApplied) { %>
    <p class="small text-muted mt-2">
      <%= searchCount %> coffees match "<%= activeQuery %>"
    </p>
    <% } else { %>
    <p class="small text-muted mt-2">
      Filter by tasting notes like caramel, bergamot, jasmine, smoke.
    </p>
    <% } %>
  </form>
</section>

<section class="shop-stats rounded-4 p-4 mb-4">
  <div class="row g-3 text-center text-md-start">
    <div class="col-md-4">
      <p class="label">Roasts per week</p>
      <p class="metric">12</p>
      <p class="caption">Profiled for pour over, espresso, and immersion.</p>
    </div>
    <div class="col-md-4">
      <p class="label">Origins on bar</p>
      <p class="metric">6</p>
      <p class="caption">Rotating menu guided by harvest calendars.</p>
    </div>
    <div class="col-md-4">
      <p class="label">Lead time</p>
      <p class="metric">&lt; 48 hrs</p>
      <p class="caption">Roasted, rested, and shipped with tracking.</p>
    </div>
  </div>
</section>

<section class="shop-pills mb-5">
  <% if (hasSections) { %>
    <% shopSections.forEach((section) => { %>
      <a class="shop-pill" href="#<%= section.key %>"><span><%= section.title %></span></a>
    <% }); %>
  <% } else { %>
    <span class="text-muted">We are roasting the next collection. Check back soon.</span>
  <% } %>
</section>

<% if (hasSections) { %>
  <% shopSections.forEach((section) => { %>
<section id="<%= section.key %>" class="shop-section mb-5">
  <div class="shop-section-header">
    <div>
      <p class="eyebrow text-uppercase"><%= section.key %></p>
      <h2 class="h3 text-dark mb-1"><%= section.title %></h2>
      <p class="text-muted mb-0"><%= section.subtitle %></p>
    </div>
    <a class="btn btn-link" href="/about">Our sourcing</a>
  </div>
  <% const placeholderImage = 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=1200&q=80'; %>
  <div class="row g-4">
    <% section.items.forEach((item) => { %>
    <div class="col-md-6 col-lg-4">
      <article class="coffee-card coffee-card--shop h-100">
        <div class="coffee-card-media <%= item.imageUrl ? '' : 'coffee-card-placeholder' %>">
          <img
            src="<%= item.imageUrl || placeholderImage %>"
            alt="<%= item.name %>"
            loading="lazy"
            onerror="this.onerror=null;this.src='<%= placeholderImage %>';"
          />
        </div>
        <div class="coffee-card-body">
          <div class="coffee-card-header">
            <div>
              <h3 class="h5 mb-1"><%= item.name %></h3>
              <% if (item.originBadge) { %>
              <p class="flag-chip mb-0"><%= item.originBadge %></p>
              <% } %>
            </div>
            <span class="badge bg-dark text-white text-uppercase"><%= item.displayRoast %></span>
            <span class="badge bg-light text-dark text-uppercase"
              ><%= item.category || 'beans' %></span
            >
          </div>
          <div class="coffee-meta">
            <div class="coffee-meta-block">
              <p class="label mb-1">Cultivar</p>
              <p class="mb-0 fw-semibold"><%= item.variety || 'Blend' %></p>
            </div>
            <div class="coffee-meta-block">
              <p class="label mb-1">Altitude</p>
              <p class="mb-0 fw-semibold"><%= item.elevation || '1,600m' %></p>
            </div>
            <div class="coffee-meta-block">
              <p class="label mb-1">Process</p>
              <p class="mb-0 fw-semibold"><%= item.process || 'Washed' %></p>
            </div>
          </div>
          <% const tags = item.tags && item.tags.length ? item.tags : item.tagList; if (tags && tags.length) { %>
          <div class="note-chips">
            <% tags.slice(0, 5).forEach((tag) => { %>
            <span class="note-chip"><%= tag %></span>
            <% }); %>
          </div>
          <% } %>
          <p class="text-muted mb-3"><%= item.description || 'Hand-roasted coffee designed for calm mornings.' %></p>
          <div class="coffee-card-footer">
            <div>
              <p class="price mb-0">
                $<%= parseFloat(item.price).toFixed(2) %>
              </p>
              <small class="text-muted">250g bag · ships in 48h</small>
            </div>
            <div class="coffee-card-actions">
              <form action="/cart/add/<%= item.id %>" method="POST">
                <input type="hidden" name="quantity" value="1" />
                <button class="btn btn-primary btn-sm w-100" type="submit">
                  Add to cart
                </button>
              </form>
              <a
                class="btn btn-outline-secondary btn-sm w-100"
                href="/menu/<%= item.id %>"
                >Details</a
              >
              <% if (user) { %>
              <form action="/wishlist/<%= item.id %>/add" method="POST">
                <button class="btn btn-light btn-sm w-100" type="submit">
                  ♡ Wishlist
                </button>
              </form>
              <% } else { %>
              <a class="btn btn-link btn-sm w-100" href="/login"
                >Login to save</a
              >
              <% } %>
            </div>
          </div>
        </div>
      </article>
    </div>
    <% }); %>
  </div>
</section>
<% }); %> <% } else { %>
<section class="empty-shop rounded-4 p-5 text-center">
  <p class="h4 mb-3">
    <% if (searchApplied) { %>No coffees match "<%= activeQuery %>"<% } else {
    %>New coffees are arriving soon.<% } %>
  </p>
  <p class="text-muted">
    <% if (searchApplied) { %> Try another flavor word or
    <a class="text-decoration-none" href="/shop">reset the filters</a>. <% }
    else { %> Sign up for our newsletter or follow along on Instagram for drop
    dates. <% } %>
  </p>
  <a class="btn btn-primary" href="/about">Learn about our sourcing</a>
</section>
<% } %>
</div>
<%- include('../partials/footer') %>
