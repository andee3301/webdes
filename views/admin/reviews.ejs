<%- include('../partials/header') %>
<section class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h4 mb-0">Reviews</h1>
    <p class="text-muted mb-0">Moderate customer feedback.</p>
  </div>
  <form class="d-flex align-items-center gap-2" method="GET" action="/admin/reviews">
    <label class="form-label mb-0 small text-muted">Status</label>
    <select class="form-select" name="status" onchange="this.form.submit()">
      <option value="all" <%= filterStatus === 'all' ? 'selected' : '' %>>All</option>
      <option value="pending" <%= filterStatus === 'pending' ? 'selected' : '' %>>Pending</option>
      <option value="approved" <%= filterStatus === 'approved' ? 'selected' : '' %>>Approved</option>
      <option value="rejected" <%= filterStatus === 'rejected' ? 'selected' : '' %>>Rejected</option>
    </select>
  </form>
</section>

<div class="table-responsive shadow-sm">
  <table class="table table-striped align-middle mb-0">
    <thead>
      <tr>
        <th>Item</th>
        <th>User</th>
        <th>Rating</th>
        <th>Comment</th>
        <th>Status</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% if (!reviews.length) { %>
      <tr>
        <td colspan="6" class="text-center text-muted">No reviews.</td>
      </tr>
      <% } %> <% reviews.forEach((review) => { %>
      <tr>
        <td><%= review.menuItem?.name %></td>
        <td><%= review.user?.name %><br /><small class="text-muted"><%= review.user?.email %></small></td>
        <td><%= review.rating %>/5</td>
        <td><%= review.comment %></td>
        <td><span class="badge bg-secondary text-uppercase"><%= review.status %></span></td>
        <td class="text-end">
          <% if (review.status === 'pending') { %>
          <form action="/admin/reviews/<%= review.id %>/approve" method="POST" class="d-inline">
            <button class="btn btn-sm btn-success" type="submit">Approve</button>
          </form>
          <form action="/admin/reviews/<%= review.id %>/reject" method="POST" class="d-inline">
            <button class="btn btn-sm btn-outline-danger" type="submit">Reject</button>
          </form>
          <% } %>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
</div>
<%- include('../partials/footer') %>
