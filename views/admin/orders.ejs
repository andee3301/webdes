<%- include('../partials/header') %>

<div class="admin-page-header">
  <div>
    <h1 class="admin-page-header__title">Order Management</h1>
    <p class="admin-page-header__subtitle">View and manage all customer orders.</p>
  </div>
  <div class="admin-page-header__actions">
    <form class="d-flex align-items-center gap-2" method="GET" action="/admin/orders">
      <select class="form-select" name="status" onchange="this.form.submit()" style="min-width: 160px;">
        <option value="all" <%= filterStatus === 'all' ? 'selected' : '' %>>All Orders</option>
        <option value="pending" <%= filterStatus === 'pending' ? 'selected' : '' %>>â³ Pending</option>
        <option value="confirmed" <%= filterStatus === 'confirmed' ? 'selected' : '' %>>âœ“ Confirmed</option>
        <option value="shipped" <%= filterStatus === 'shipped' ? 'selected' : '' %>>ğŸšš Shipped</option>
        <option value="completed" <%= filterStatus === 'completed' ? 'selected' : '' %>>âœ… Completed</option>
        <option value="cancelled" <%= filterStatus === 'cancelled' ? 'selected' : '' %>>âŒ Cancelled</option>
      </select>
    </form>
    <a class="btn btn-outline-secondary" href="/admin">â† Dashboard</a>
  </div>
</div>

<% if (!orders.length) { %>
<div class="empty-state">
  <div class="empty-state__icon">ğŸ“¦</div>
  <h3 class="empty-state__title">No orders found</h3>
  <p class="empty-state__text">
    <% if (filterStatus !== 'all') { %>
    No <%= filterStatus %> orders at the moment.
    <% } else { %>
    Orders will appear here when customers make purchases.
    <% } %>
  </p>
  <% if (filterStatus !== 'all') { %>
  <a class="btn btn-primary" href="/admin/orders">View All Orders</a>
  <% } %>
</div>
<% } else { %>

<div class="order-blocks">
  <% orders.forEach((order) => { %>
  <div class="order-block">
    <div class="order-block__header">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <span class="order-block__id">Order #<%= order.id %></span>
        <span class="status-badge status-badge--<%= order.status %>">
          <%= order.status %>
        </span>
      </div>
      <span class="order-block__date">
        <%= new Date(order.createdAt).toLocaleDateString('en-US', { 
          weekday: 'short', 
          year: 'numeric', 
          month: 'short', 
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }) %>
      </span>
    </div>
    
    <div class="order-block__body">
      <div class="order-block__customer">
        <span class="order-block__label">Customer</span>
        <span class="order-block__value"><%= order.user ? order.user.name : 'Guest' %></span>
        <% if (order.user && order.user.email) { %>
        <small style="color: var(--muted-ink); display: block;"><%= order.user.email %></small>
        <% } %>
      </div>
      <div class="order-block__customer">
        <span class="order-block__label">Items</span>
        <span class="order-block__value"><%= order.items ? order.items.length : 0 %> products</span>
      </div>
      <div class="order-block__customer">
        <span class="order-block__label">Total</span>
        <span class="order-block__value" style="color: var(--burnt-amber); font-weight: 700; font-size: 1.25rem;">
          $<%= parseFloat(order.totalPrice).toFixed(2) %>
        </span>
      </div>

      <% if (order.items && order.items.length) { %>
      <div class="order-block__items">
        <span class="order-block__label" style="display: block; margin-bottom: 0.5rem;">Order Items</span>
        <div class="order-block__items-list">
          <% order.items.forEach((item) => { %>
          <div class="order-item-chip">
            <span class="order-item-chip__qty"><%= item.quantity %>Ã—</span>
            <span><%= item.menuItem ? item.menuItem.name : 'Unknown' %></span>
            <span style="color: var(--muted-ink);">$<%= parseFloat(item.subtotal).toFixed(2) %></span>
          </div>
          <% }); %>
        </div>
      </div>
      <% } %>
    </div>

    <div class="order-block__footer">
      <div class="order-block__total">
        Total: $<%= parseFloat(order.totalPrice).toFixed(2) %>
      </div>
      <div style="display: flex; gap: 0.5rem;">
        <a class="btn btn-primary btn-sm" href="/admin/orders/<%= order.id %>">Manage Order</a>
      </div>
    </div>
  </div>
  <% }); %>
</div>

<% } %>

<%- include('../partials/footer') %>
